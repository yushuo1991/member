# ğŸš€ å®ŒæˆMonorepoéƒ¨ç½² - æœ€ç»ˆæ­¥éª¤

## ğŸ“Š å½“å‰éƒ¨ç½²çŠ¶æ€

âœ… **å·²å®Œæˆ**:
- æ­¥éª¤1: åˆ›å»ºå®Œæ•´å¤‡ä»½ï¼ˆä»£ç 90MB + æ•°æ®åº“ï¼‰
- æ­¥éª¤2: åœæ­¢æ—§ç³»ç»ŸæœåŠ¡ï¼ˆmember-systemå·²åœæ­¢ï¼‰
- æ­¥éª¤3: ä»GitHubæ‹‰å–ä»£ç ï¼ˆ795ä¸ªæ–‡ä»¶ï¼‰
- æ­¥éª¤4a: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ4ä¸ªåº”ç”¨çš„.envï¼‰
- æ­¥éª¤4b: å®‰è£…pnpmå’Œä¾èµ–ï¼ˆ336ä¸ªåŒ…ï¼‰

â³ **å¾…å®Œæˆ**:
- æ­¥éª¤4c: æ„å»ºåº”ç”¨ï¼ˆå¯èƒ½å·²éƒ¨åˆ†å®Œæˆï¼‰
- æ­¥éª¤5: å¯åŠ¨PM2æœåŠ¡
- æ­¥éª¤6: å¥åº·æ£€æŸ¥

---

## âš¡ å¿«é€Ÿå®Œæˆæ–¹æ³•ï¼ˆæ¨èï¼‰

### æ–¹å¼1: ç›´æ¥SSHç™»å½•æ‰§è¡Œ

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh root@8.153.110.212

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/member-monorepo

# 3. ä¸‹è½½å¹¶æ‰§è¡Œå®Œæˆè„šæœ¬
curl -O https://raw.githubusercontent.com/yushuo1991/member/main/finish-deploy-server.sh
chmod +x finish-deploy-server.sh
bash finish-deploy-server.sh
```

### æ–¹å¼2: é€æ­¥æ‰‹åŠ¨æ‰§è¡Œ

SSHç™»å½•åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /www/wwwroot/member-monorepo

# === æ­¥éª¤1: æ£€æŸ¥æ„å»ºçŠ¶æ€ ===
ls -la apps/web/.next
ls -la apps/bk/.next
ls -la apps/fuplan/.next
ls -la apps/xinli/.next

# å¦‚æœæŸä¸ªåº”ç”¨æœªæ„å»ºï¼Œå•ç‹¬æ„å»ºï¼š
cd apps/web && pnpm build && cd ../..
cd apps/bk && pnpm build && cd ../..
cd apps/fuplan && pnpm build && cd ../..
cd apps/xinli && pnpm build && cd ../..

# === æ­¥éª¤2: åˆ›å»ºPM2é…ç½® ===
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'member-web',
      cwd: '/www/wwwroot/member-monorepo/apps/web',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3000',
      instances: 1,
      autorestart: true,
      max_memory_restart: '1G',
      env: { NODE_ENV: 'production', PORT: 3000 }
    },
    {
      name: 'member-bk',
      cwd: '/www/wwwroot/member-monorepo/apps/bk',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3001',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3001 }
    },
    {
      name: 'member-fuplan',
      cwd: '/www/wwwroot/member-monorepo/apps/fuplan',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3002',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3002 }
    },
    {
      name: 'member-xinli',
      cwd: '/www/wwwroot/member-monorepo/apps/xinli',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3003',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3003 }
    }
  ]
};
EOF

# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# === æ­¥éª¤3: å¯åŠ¨æ‰€æœ‰æœåŠ¡ ===
pm2 delete all  # åˆ é™¤æ‰€æœ‰æ—§è¿›ç¨‹
pm2 start ecosystem.config.js
pm2 save
pm2 list

# === æ­¥éª¤4: æ£€æŸ¥çŠ¶æ€ ===
sleep 5
netstat -tlnp | grep -E ":(3000|3001|3002|3003)"
curl -I http://localhost:3000
curl -I http://localhost:3001
curl -I http://localhost:3002
curl -I http://localhost:3003
```

---

## ğŸ” éªŒè¯éƒ¨ç½²æˆåŠŸ

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- **Webåº”ç”¨**: http://8.153.110.212:3000
- **BKåº”ç”¨**: http://8.153.110.212:3001
- **Fuplanåº”ç”¨**: http://8.153.110.212:3002
- **Xinliåº”ç”¨**: http://8.153.110.212:3003

**æ£€æŸ¥ç‚¹**:
- [ ] æ‰€æœ‰4ä¸ªåº”ç”¨éƒ½èƒ½è®¿é—®
- [ ] PM2æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¸º"online"çŠ¶æ€
- [ ] æ²¡æœ‰é”™è¯¯æ—¥å¿—

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: æ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹é”™è¯¯è¯¦æƒ…
cd /www/wwwroot/member-monorepo
pnpm build 2>&1 | tee build.log

# å•ç‹¬æ„å»ºæŸä¸ªåº”ç”¨
cd apps/web
pnpm build
```

### é—®é¢˜2: PM2å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs member-web --lines 50
pm2 logs member-bk --lines 50

# æ‰‹åŠ¨å¯åŠ¨å•ä¸ªåº”ç”¨æµ‹è¯•
cd /www/wwwroot/member-monorepo/apps/web
./node_modules/next/dist/bin/next start -p 3000
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
netstat -tlnp | grep :3000
lsof -i :3000

# åœæ­¢å ç”¨è¿›ç¨‹
kill -9 <PID>
```

### é—®é¢˜4: æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -u root -p'ChangeMe2026!Secure' -e "SELECT 1;"

# æ£€æŸ¥ç¯å¢ƒå˜é‡
cd /www/wwwroot/member-monorepo
cat apps/web/.env | grep DB_
```

---

## ğŸ”„ å¦‚æœéœ€è¦å›æ»š

```bash
# åœæ­¢æ–°ç³»ç»Ÿ
pm2 stop all
pm2 delete all

# æ¢å¤æ—§ç³»ç»Ÿ
cd /www/wwwroot/backups
tar -xzf member-system-backup-20260124-184840.tar.gz -C /www/wwwroot/

# å¯åŠ¨æ—§ç³»ç»Ÿ
cd /www/wwwroot/member-system
pm2 start ecosystem.config.js
pm2 save
```

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼š
1. é”™è¯¯ä¿¡æ¯æˆªå›¾
2. `pm2 logs`çš„è¾“å‡º
3. è®¿é—®åº”ç”¨æ—¶çš„é”™è¯¯

æˆ‘ä¼šç«‹å³å¸®æ‚¨è§£å†³ï¼

---

**éƒ¨ç½²è„šæœ¬ä½ç½®**:
- æœ¬åœ°: `C:\Users\yushu\Desktop\æˆ‘çš„ä¼šå‘˜ä½“ç³»\finish-deploy-server.sh`
- æœåŠ¡å™¨: æ‰‹åŠ¨å¤åˆ¶ä¸Šè¿°å‘½ä»¤æ‰§è¡Œ

**é¢„è®¡å®Œæˆæ—¶é—´**: 5-10åˆ†é’Ÿ
**éƒ¨ç½²æ—¶é—´**: 2026-01-24 18:48

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] SSHç™»å½•æœåŠ¡å™¨æˆåŠŸ
- [ ] è¿›å…¥/www/wwwroot/member-monorepoç›®å½•
- [ ] æ‰€æœ‰åº”ç”¨æ„å»ºå®Œæˆï¼ˆ.nextç›®å½•å­˜åœ¨ï¼‰
- [ ] PM2é…ç½®æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- [ ] PM2å¯åŠ¨æ‰€æœ‰4ä¸ªåº”ç”¨
- [ ] PM2æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹online
- [ ] è®¿é—®4ä¸ªåº”ç”¨URLéƒ½æ­£å¸¸
- [ ] æŸ¥çœ‹æ—¥å¿—æ— ä¸¥é‡é”™è¯¯
- [ ] pm2 saveä¿å­˜é…ç½®
- [ ] æµ‹è¯•æ³¨å†Œ/ç™»å½•åŠŸèƒ½

å®Œæˆä»¥ä¸Šæ£€æŸ¥åï¼Œéƒ¨ç½²å°±æˆåŠŸäº†ï¼ğŸ‰
