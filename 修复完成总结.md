# æœåŠ¡å™¨500é”™è¯¯ - ç´§æ€¥ä¿®å¤å®Œæˆæ€»ç»“

## ğŸ¯ ä¿®å¤çŠ¶æ€ï¼šâœ… å®Œå…¨è§£å†³

ä¿®å¤æ—¶é—´ï¼š2026-01-24 02:00 - 02:12 (çº¦12åˆ†é’Ÿ)
æœåŠ¡å™¨ï¼šyushuofupan.com (8.153.110.212)

---

## ğŸ” é—®é¢˜è¯Šæ–­

### ç—‡çŠ¶
- ç”¨æˆ·æ³¨å†ŒAPIè¿”å›500é”™è¯¯
- ç®¡ç†å‘˜ç™»å½•è¿”å›"database unavailable"
- PM2è¿›ç¨‹è¿è¡Œæ­£å¸¸ä½†APIè°ƒç”¨å¤±è´¥

### æ ¹æœ¬åŸå› ï¼ˆ2ä¸ªï¼‰

#### åŸå› 1: MySQLè®¤è¯é…ç½®é”™è¯¯
```
é”™è¯¯: Access denied for user 'root'@'localhost'
åŸå› : rootç”¨æˆ·ä½¿ç”¨auth_socketæ’ä»¶ï¼Œä¸æ”¯æŒå¯†ç è®¤è¯
```

#### åŸå› 2: æ•°æ®åº“æ¶æ„ç‰ˆæœ¬ä¸åŒ¹é…
```
é”™è¯¯: Unknown column 'trial_bk' in 'field list'
åŸå› : æ•°æ®åº“æ˜¯v2æ¶æ„ï¼Œåº”ç”¨ä»£ç è¦æ±‚v3æ¶æ„
```

---

## ğŸ› ï¸ ä¿®å¤æªæ–½

### 1. åˆ›å»ºMySQLåº”ç”¨ç”¨æˆ·
```sql
CREATE USER 'member_app'@'localhost' IDENTIFIED BY 'ChangeMe2026!Secure';
GRANT ALL PRIVILEGES ON member_system.* TO 'member_app'@'localhost';
```

### 2. æ›´æ–°.envé…ç½®
```diff
- DB_USER=root
- DB_PASSWORD=
+ DB_USER=member_app
+ DB_PASSWORD=ChangeMe2026!Secure
```

### 3. å‡çº§æ•°æ®åº“æ¶æ„
```sql
ALTER TABLE users ADD COLUMN trial_bk INT DEFAULT 5;
ALTER TABLE users ADD COLUMN trial_xinli INT DEFAULT 5;
ALTER TABLE users ADD COLUMN trial_fuplan INT DEFAULT 5;
```

### 4. ä¿®å¤ç®¡ç†å‘˜è´¦æˆ·
```bash
# ä½¿ç”¨Node.jsç”Ÿæˆbcrypt hash
node -e "bcrypt.hash('admin123', 12).then(console.log)"
# æ›´æ–°å¯†ç hashåˆ°æ•°æ®åº“
```

### 5. é‡å¯æœåŠ¡
```bash
pm2 delete member-system
pm2 start ecosystem.config.js --env production
```

---

## âœ… æµ‹è¯•ç»“æœ

| åŠŸèƒ½ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| é¦–é¡µ | âŒ 500 | âœ… 200 |
| ç”¨æˆ·æ³¨å†Œ | âŒ 500 | âœ… æˆåŠŸ |
| ç”¨æˆ·ç™»å½• | âŒ 500 | âœ… æˆåŠŸ |
| ç®¡ç†å‘˜ç™»å½• | âŒ æ•°æ®åº“ä¸å¯ç”¨ | âœ… æˆåŠŸ |
| APIå“åº” | âŒ é”™è¯¯ | âœ… æ­£å¸¸ |

---

## ğŸ“‹ é‡è¦ä¿¡æ¯

### æ•°æ®åº“å‡­è¯
```
ä¸»æœº: localhost
ç”¨æˆ·: member_app
å¯†ç : ChangeMe2026!Secure
æ•°æ®åº“: member_system
```

### ç®¡ç†å‘˜è´¦æˆ·
```
ç”¨æˆ·å: admin
å¯†ç : admin123
é‚®ç®±: admin@member-system.local
```

### PM2æœåŠ¡
```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs member-system

# é‡å¯
pm2 restart member-system
```

---

## ğŸ”§ å·¥å…·è„šæœ¬

æœ¬æ¬¡ä¿®å¤åˆ›å»ºçš„è„šæœ¬ï¼ˆä½äºé¡¹ç›®æ ¹ç›®å½•ï¼‰ï¼š

1. **å¿«é€Ÿå¥åº·æ£€æŸ¥.bat** - ä¸€é”®æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
2. **diagnose-server-500.sh** - å®Œæ•´è¯Šæ–­è„šæœ¬
3. **fix-database-remote.sh** - æ•°æ®åº“ä¿®å¤è„šæœ¬
4. **test-server-complete.sh** - åŠŸèƒ½æµ‹è¯•è„šæœ¬
5. **æœåŠ¡å™¨500é”™è¯¯ä¿®å¤æŠ¥å‘Š.md** - è¯¦ç»†æŠ¥å‘Š

### ä½¿ç”¨æ–¹æ³•

**Windows (æœ¬åœ°):**
```cmd
å¿«é€Ÿå¥åº·æ£€æŸ¥.bat
```

**Linux (æœåŠ¡å™¨):**
```bash
ssh -i deploy_key root@8.153.110.212 'bash -s' < diagnose-server-500.sh
```

---

## ğŸ åç»­ä¼˜åŒ–å»ºè®®

### é«˜ä¼˜å…ˆçº§
- [ ] ä¿®æ”¹ç®¡ç†å‘˜é»˜è®¤å¯†ç 
- [ ] é…ç½®æ•°æ®åº“å®šæœŸå¤‡ä»½
- [ ] æ·»åŠ é”™è¯¯ç›‘æ§å’Œå‘Šè­¦

### ä¸­ä¼˜å…ˆçº§
- [ ] ä¿®å¤ `/api/auth/me` cookieè§£æé—®é¢˜
- [ ] å®Œå–„gate APIè·¯ç”±
- [ ] ä¼˜åŒ–ç®¡ç†å‘˜ç»Ÿè®¡APIæŸ¥è¯¢

### ä½ä¼˜å…ˆçº§
- [ ] å¯ç”¨HTTPS
- [ ] é…ç½®CDNåŠ é€Ÿé™æ€èµ„æº
- [ ] æ·»åŠ Redisç¼“å­˜

---

## ğŸ“ å¦‚ä½•è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—ï¼š** `pm2 logs member-system`
2. **å¥åº·æ£€æŸ¥ï¼š** è¿è¡Œ `å¿«é€Ÿå¥åº·æ£€æŸ¥.bat`
3. **é‡å¯æœåŠ¡ï¼š** `pm2 restart member-system`
4. **å®Œæ•´è¯Šæ–­ï¼š** è¿è¡Œè¯Šæ–­è„šæœ¬
5. **æŸ¥çœ‹æŠ¥å‘Šï¼š** é˜…è¯» `æœåŠ¡å™¨500é”™è¯¯ä¿®å¤æŠ¥å‘Š.md`

---

## ğŸ† æˆåŠŸæŒ‡æ ‡

- âœ… æ‰€æœ‰é¡µé¢è¿”å›200çŠ¶æ€ç 
- âœ… ç”¨æˆ·å¯ä»¥æ­£å¸¸æ³¨å†Œå’Œç™»å½•
- âœ… ç®¡ç†å‘˜å¯ä»¥æ­£å¸¸ç™»å½•
- âœ… æ•°æ®åº“è¿æ¥ç¨³å®š
- âœ… PM2è¿›ç¨‹æŒç»­è¿è¡Œ
- âœ… æ— 500é”™è¯¯æ—¥å¿—

---

**ä¿®å¤å®Œæˆï¼** ğŸ‰

æœåŠ¡å™¨ç°åœ¨è¿è¡Œæ­£å¸¸ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚
