# ğŸ¯ å®Œæˆéƒ¨ç½² - 3ä¸ªå¯é€‰æ–¹æ³•

ç”±äºSSHè¿æ¥ä¸å¤ªç¨³å®šï¼Œæˆ‘ä¸ºæ‚¨å‡†å¤‡äº†3ä¸ªæ–¹æ³•ï¼Œä»»é€‰ä¸€ä¸ªå³å¯ï¼š

---

## æ–¹æ³•1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬ï¼ˆæœ€æ¨èï¼‰

### æ­¥éª¤1: ä¸Šä¼ è„šæœ¬
```bash
# åœ¨æœ¬åœ°PowerShellæ‰§è¡Œï¼ˆå¯èƒ½éœ€è¦å¤šè¯•å‡ æ¬¡ï¼‰
scp C:\Users\yushu\Desktop\æˆ‘çš„ä¼šå‘˜ä½“ç³»\deploy-finish.sh root@8.153.110.212:/www/wwwroot/member-monorepo/
```

### æ­¥éª¤2: SSHç™»å½•æ‰§è¡Œ
```bash
ssh root@8.153.110.212
cd /www/wwwroot/member-monorepo
bash deploy-finish.sh
```

---

## æ–¹æ³•2: ä¸€æ¡å‘½ä»¤å®Œæˆï¼ˆæœ€å¿«ï¼‰

SSHç™»å½•åï¼Œå¤åˆ¶ç²˜è´´è¿™æ¡å‘½ä»¤ï¼š

```bash
cd /www/wwwroot/member-monorepo && pnpm build && cat > ecosystem.config.js << 'EOF'
module.exports = { apps: [ { name: 'member-web', cwd: '/www/wwwroot/member-monorepo/apps/web', script: './node_modules/next/dist/bin/next', args: 'start -p 3000', instances: 1, autorestart: true, max_memory_restart: '1G', env: { NODE_ENV: 'production', PORT: 3000 } }, { name: 'member-bk', cwd: '/www/wwwroot/member-monorepo/apps/bk', script: './node_modules/next/dist/bin/next', args: 'start -p 3001', instances: 1, autorestart: true, max_memory_restart: '512M', env: { NODE_ENV: 'production', PORT: 3001 } }, { name: 'member-fuplan', cwd: '/www/wwwroot/member-monorepo/apps/fuplan', script: './node_modules/next/dist/bin/next', args: 'start -p 3002', instances: 1, autorestart: true, max_memory_restart: '512M', env: { NODE_ENV: 'production', PORT: 3002 } }, { name: 'member-xinli', cwd: '/www/wwwroot/member-monorepo/apps/xinli', script: './node_modules/next/dist/bin/next', args: 'start -p 3003', instances: 1, autorestart: true, max_memory_restart: '512M', env: { NODE_ENV: 'production', PORT: 3003 } } ] };
EOF
pm2 delete all && pm2 start ecosystem.config.js && pm2 save && pm2 list
```

---

## æ–¹æ³•3: åˆ†æ­¥æ‰‹åŠ¨æ‰§è¡Œï¼ˆæœ€ç¨³å¦¥ï¼‰

SSHç™»å½•åï¼Œé€æ¡æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥ç›®å½•
cd /www/wwwroot/member-monorepo

# 2. æ„å»ºåº”ç”¨ï¼ˆ5-8åˆ†é’Ÿï¼‰
pnpm build

# 3. æ£€æŸ¥æ„å»ºç»“æœ
ls -la apps/web/.next
ls -la apps/bk/.next
ls -la apps/fuplan/.next
ls -la apps/xinli/.next

# 4. åˆ›å»ºPM2é…ç½®ï¼ˆå¤åˆ¶æ•´æ®µï¼‰
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'member-web',
      cwd: '/www/wwwroot/member-monorepo/apps/web',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3000',
      instances: 1,
      autorestart: true,
      max_memory_restart: '1G',
      env: { NODE_ENV: 'production', PORT: 3000 }
    },
    {
      name: 'member-bk',
      cwd: '/www/wwwroot/member-monorepo/apps/bk',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3001',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3001 }
    },
    {
      name: 'member-fuplan',
      cwd: '/www/wwwroot/member-monorepo/apps/fuplan',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3002',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3002 }
    },
    {
      name: 'member-xinli',
      cwd: '/www/wwwroot/member-monorepo/apps/xinli',
      script: './node_modules/next/dist/bin/next',
      args: 'start -p 3003',
      instances: 1,
      autorestart: true,
      max_memory_restart: '512M',
      env: { NODE_ENV: 'production', PORT: 3003 }
    }
  ]
};
EOF

# 5. å¯åŠ¨æœåŠ¡
pm2 delete all
pm2 start ecosystem.config.js
pm2 save

# 6. æŸ¥çœ‹çŠ¶æ€
pm2 list

# 7. æŸ¥çœ‹æ—¥å¿—ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼‰
pm2 logs --lines 20
```

---

## âœ… éªŒè¯éƒ¨ç½²æˆåŠŸ

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼š

- http://8.153.110.212:3000 (Webåº”ç”¨ - ä¼šå‘˜ç®¡ç†)
- http://8.153.110.212:3001 (BKåº”ç”¨ - æ¿å—èŠ‚å¥)
- http://8.153.110.212:3002 (Fuplanåº”ç”¨ - å¤ç›˜ç³»ç»Ÿ)
- http://8.153.110.212:3003 (Xinliåº”ç”¨ - å¿ƒç†æµ‹è¯„)

**æ£€æŸ¥æ¸…å•**:
- [ ] æ‰€æœ‰4ä¸ªURLéƒ½èƒ½è®¿é—®
- [ ] `pm2 list` æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¸º "online"
- [ ] `pm2 logs` æ²¡æœ‰ä¸¥é‡é”™è¯¯

---

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜1: pnpm build å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
pnpm build 2>&1 | tee build-error.log
cat build-error.log

# å•ç‹¬æ„å»ºæŸä¸ªåº”ç”¨
cd apps/web
pnpm build
cd ../..
```

### é—®é¢˜2: PM2å¯åŠ¨åç«‹å³åœæ­¢

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs member-web --err --lines 50

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
cd apps/web
./node_modules/next/dist/bin/next start -p 3000
```

### é—®é¢˜3: ç«¯å£è®¿é—®ä¸äº†

```bash
# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep :3000

# æ£€æŸ¥é˜²ç«å¢™
ufw status
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶ä½ç½®

- `deploy-finish.sh` - å®Œæ•´éƒ¨ç½²è„šæœ¬ï¼ˆæœ¬åœ°å·²åˆ›å»ºï¼‰
- `ç›´æ¥æ‰§è¡Œè„šæœ¬.sh` - ç®€åŒ–ç‰ˆè„šæœ¬
- `å®Œæˆéƒ¨ç½²æŒ‡å—.md` - è¯¦ç»†æ–‡æ¡£

---

**æˆ‘çš„å»ºè®®**: ä½¿ç”¨**æ–¹æ³•2**ï¼ˆä¸€æ¡å‘½ä»¤ï¼‰ï¼Œæœ€å¿«æœ€ç®€å•ï¼

éœ€è¦æˆ‘ç»§ç»­ååŠ©å—ï¼Ÿæˆ–è€…æ‚¨å·²ç»å¼€å§‹æ‰§è¡Œäº†ï¼Ÿ
