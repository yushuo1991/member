# ğŸš€ ç»§ç»­å®Œæˆéƒ¨ç½² - æ‰‹åŠ¨æ­¥éª¤

æ„å»ºæ­£åœ¨æœåŠ¡å™¨åå°è¿è¡Œä¸­ã€‚ä¸ºäº†åŠ å¿«éƒ¨ç½²ï¼Œæ‚¨å¯ä»¥ï¼š

## æ–¹å¼1: ç­‰å¾…è‡ªåŠ¨å®Œæˆï¼ˆæ¨èï¼‰

æ„å»ºä¼šè‡ªåŠ¨å®Œæˆï¼Œè¯·ç»§ç»­ç­‰å¾…çº¦3-5åˆ†é’Ÿã€‚

## æ–¹å¼2: æ‰‹åŠ¨å®Œæˆéƒ¨ç½²ï¼ˆå¿«é€Ÿï¼‰

å¦‚æœæƒ³è¦ç«‹å³å®Œæˆï¼Œè¯·SSHç™»å½•æœåŠ¡å™¨æ‰‹åŠ¨æ‰§è¡Œï¼š

```bash
# 1. SSHç™»å½•æœåŠ¡å™¨
ssh root@8.153.110.212

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/member-monorepo

# 3. æ£€æŸ¥æ„å»ºçŠ¶æ€
ls -la apps/web/.next
ls -la apps/bk/.next
ls -la apps/fuplan/.next
ls -la apps/xinli/.next

# 4. å¦‚æœæ„å»ºæœªå®Œæˆï¼Œæ‰‹åŠ¨æ„å»º
pnpm build

# 5. æ„å»ºå®Œæˆåï¼Œåˆ›å»ºPM2é…ç½®
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [
    {
      name: 'member-web',
      cwd: '/www/wwwroot/member-monorepo/apps/web',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3000',
      instances: 1,
      autorestart: true,
      env: { NODE_ENV: 'production', PORT: 3000 }
    },
    {
      name: 'member-bk',
      cwd: '/www/wwwroot/member-monorepo/apps/bk',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3001',
      instances: 1,
      autorestart: true,
      env: { NODE_ENV: 'production', PORT: 3001 }
    },
    {
      name: 'member-fuplan',
      cwd: '/www/wwwroot/member-monorepo/apps/fuplan',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3002',
      instances: 1,
      autorestart: true,
      env: { NODE_ENV: 'production', PORT: 3002 }
    },
    {
      name: 'member-xinli',
      cwd: '/www/wwwroot/member-monorepo/apps/xinli',
      script: 'node_modules/next/dist/bin/next',
      args: 'start -p 3003',
      instances: 1,
      autorestart: true,
      env: { NODE_ENV: 'production', PORT: 3003 }
    }
  ]
};
EOF

# 6. åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# 7. åˆ é™¤æ—§çš„PM2è¿›ç¨‹
pm2 delete all

# 8. å¯åŠ¨æ‰€æœ‰åº”ç”¨
pm2 start ecosystem.config.js

# 9. æŸ¥çœ‹çŠ¶æ€
pm2 list

# 10. ä¿å­˜PM2é…ç½®
pm2 save

# 11. è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup

# 12. æŸ¥çœ‹æ—¥å¿—ï¼ˆç¡®ä¿æ²¡æœ‰é”™è¯¯ï¼‰
pm2 logs --lines 20
```

## éªŒè¯éƒ¨ç½²

è®¿é—®ä»¥ä¸‹åœ°å€æµ‹è¯•ï¼š

- Webåº”ç”¨: http://8.153.110.212:3000
- BKåº”ç”¨: http://8.153.110.212:3001
- Fuplanåº”ç”¨: http://8.153.110.212:3002
- Xinliåº”ç”¨: http://8.153.110.212:3003

## å¦‚æœé‡åˆ°é—®é¢˜

### é—®é¢˜1: æ„å»ºå¤±è´¥
```bash
cd /www/wwwroot/member-monorepo
pnpm install
pnpm build 2>&1 | tee build.log
# æŸ¥çœ‹ build.log æ‰¾å‡ºé”™è¯¯
```

### é—®é¢˜2: PM2å¯åŠ¨å¤±è´¥
```bash
pm2 logs member-web
pm2 logs member-bk
# æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜3: ç«¯å£è¢«å ç”¨
```bash
netstat -tlnp | grep :3000
# æ‰¾åˆ°å ç”¨è¿›ç¨‹å¹¶kill
kill -9 <PID>
```

## å›æ»šåˆ°æ—§ç³»ç»Ÿ

å¦‚æœæ–°ç³»ç»Ÿæœ‰é—®é¢˜ï¼Œç«‹å³å›æ»šï¼š

```bash
cd /www/wwwroot
pm2 stop all
pm2 delete all

# æ¢å¤å¤‡ä»½
cd backups
tar -xzf member-system-backup-20260124-184840.tar.gz -C /www/wwwroot/

# å¯åŠ¨æ—§ç³»ç»Ÿ
cd /www/wwwroot/member-system
pm2 start ecosystem.config.js
pm2 save
```

---

**å½“å‰çŠ¶æ€**:
- âœ… æ­¥éª¤1-3å®Œæˆï¼ˆå¤‡ä»½ã€åœæ­¢æ—§ç³»ç»Ÿã€ä»£ç ä¸Šä¼ ï¼‰
- â³ æ­¥éª¤4è¿›è¡Œä¸­ï¼ˆæ„å»ºåº”ç”¨ï¼‰
- â¸ï¸  æ­¥éª¤5-7å¾…æ‰§è¡Œï¼ˆå¯åŠ¨æœåŠ¡ã€å¥åº·æ£€æŸ¥ï¼‰

è¯·é€‰æ‹©ç»§ç»­æ–¹å¼ï¼Œæˆ‘ä¼šååŠ©æ‚¨å®Œæˆï¼
