# SSHå…å¯†ç™»å½•é…ç½®å®ŒæˆæŠ¥å‘Š

## é…ç½®çŠ¶æ€

âœ… **SSHå…å¯†ç™»å½•å·²æˆåŠŸé…ç½®å¹¶æµ‹è¯•é€šè¿‡**

## é…ç½®è¯¦æƒ…

### 1. å¯†é’¥ä¿¡æ¯
- **ç§é’¥ä½ç½®**:
  - `C:\Users\yushu\Desktop\æˆ‘çš„ä¼šå‘˜ä½“ç³»\deploy_key`
  - `C:\Users\yushu\.ssh\deploy_key`
- **å…¬é’¥ä½ç½®**:
  - `C:\Users\yushu\Desktop\æˆ‘çš„ä¼šå‘˜ä½“ç³»\deploy_key.pub`
  - `C:\Users\yushu\.ssh\deploy_key.pub`
- **å¯†é’¥ç±»å‹**: ED25519
- **å…¬é’¥æŒ‡çº¹**: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOFAGwceN5e174dtdCnoySn7Qrqa5pz7UcOTprh0pZRs

### 2. SSH Config é…ç½®
ä½ç½®: `C:\Users\yushu\.ssh\config`

```
Host member-server
    HostName 8.153.110.212
    User root
    IdentityFile ~/.ssh/deploy_key
    StrictHostKeyChecking no

Host 8.153.110.212
    User root
    IdentityFile ~/.ssh/deploy_key
    StrictHostKeyChecking no
```

### 3. æœåŠ¡å™¨é…ç½®
- **æœåŠ¡å™¨IP**: 8.153.110.212
- **ç”¨æˆ·**: root
- **å…¬é’¥å·²æ·»åŠ åˆ°**: `/root/.ssh/authorized_keys`
- **æœåŠ¡å™¨ç³»ç»Ÿ**: Ubuntu (5.15.0-161-generic)

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1: ä½¿ç”¨åˆ«åï¼ˆæ¨èï¼‰
```bash
ssh member-server
```

### æ–¹å¼2: ä½¿ç”¨ IP åœ°å€
```bash
ssh root@8.153.110.212
```

### æ–¹å¼3: æŒ‡å®šå¯†é’¥æ–‡ä»¶
```bash
ssh -i deploy_key root@8.153.110.212
ssh -i ~/.ssh/deploy_key root@8.153.110.212
```

### æ–¹å¼4: ä½¿ç”¨å¿«æ·å·¥å…·
åŒå‡»è¿è¡Œä»¥ä¸‹æ‰¹å¤„ç†æ–‡ä»¶ï¼š
- `æµ‹è¯•SSHå…å¯†ç™»å½•.bat` - æµ‹è¯•å…å¯†ç™»å½•æ˜¯å¦æ­£å¸¸
- `æœåŠ¡å™¨ç®¡ç†å·¥å…·.bat` - å›¾å½¢åŒ–èœå•ç®¡ç†æœåŠ¡å™¨

## æµ‹è¯•ç»“æœ

```
âœ“ åˆ«åç™»å½•æµ‹è¯•é€šè¿‡ (ssh member-server)
âœ“ IPç™»å½•æµ‹è¯•é€šè¿‡ (ssh root@8.153.110.212)
âœ“ PM2 è¿›ç¨‹çŠ¶æ€æ­£å¸¸
âœ“ æœåŠ¡å™¨å“åº”æ­£å¸¸
```

å½“å‰æœåŠ¡å™¨çŠ¶æ€:
- PM2 è¿›ç¨‹: member-system (online, 84MB å†…å­˜)
- ç³»ç»Ÿ: Linux Ubuntu 5.15.0-161-generic
- ä¸»æœºå: iZuf65vp3vbgfmwib1ohetZ

## å¸¸ç”¨å‘½ä»¤å¿«é€Ÿå‚è€ƒ

### ç™»å½•æœåŠ¡å™¨
```bash
ssh member-server
```

### æŸ¥çœ‹ PM2 çŠ¶æ€
```bash
ssh member-server "pm2 list"
```

### æŸ¥çœ‹æ—¥å¿—
```bash
ssh member-server "pm2 logs member-system --lines 50"
```

### é‡å¯æœåŠ¡
```bash
ssh member-server "pm2 restart member-system"
```

### éƒ¨ç½²æ›´æ–°
```bash
ssh member-server "cd /www/wwwroot/member-system && git pull && npm ci --only=production && pm2 restart member-system"
```

### æŸ¥çœ‹ç³»ç»Ÿèµ„æº
```bash
ssh member-server "free -h && df -h"
```

### æ‰§è¡Œæ•°æ®åº“å‘½ä»¤
```bash
ssh member-server "mysql -u root -p member_system -e 'SELECT COUNT(*) FROM users;'"
```

## æ‰¹å¤„ç†å·¥å…·è¯´æ˜

### 1. é…ç½®SSHå…å¯†ç™»å½•.bat
ç”¨äºé¦–æ¬¡é…ç½®æˆ–é‡æ–°é…ç½® SSH å…å¯†ç™»å½•ã€‚åŠŸèƒ½åŒ…æ‹¬ï¼š
- ä¸Šä¼ å…¬é’¥åˆ°æœåŠ¡å™¨
- å¤åˆ¶å¯†é’¥åˆ° .ssh ç›®å½•
- é…ç½® SSH config æ–‡ä»¶
- è‡ªåŠ¨æµ‹è¯•å…å¯†ç™»å½•

### 2. æµ‹è¯•SSHå…å¯†ç™»å½•.bat
å¿«é€Ÿæµ‹è¯• SSH å…å¯†ç™»å½•æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚æµ‹è¯•é¡¹ç›®ï¼š
- åˆ«åç™»å½•æµ‹è¯•
- IP åœ°å€ç™»å½•æµ‹è¯•
- æœåŠ¡å™¨çŠ¶æ€æŸ¥è¯¢

### 3. æœåŠ¡å™¨ç®¡ç†å·¥å…·.bat
å›¾å½¢åŒ–èœå•å·¥å…·ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š
1. ç™»å½•æœåŠ¡å™¨
2. æŸ¥çœ‹ PM2 è¿›ç¨‹çŠ¶æ€
3. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
4. é‡å¯ä¼šå‘˜ç³»ç»ŸæœåŠ¡
5. æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
6. éƒ¨ç½²æœ€æ–°ä»£ç 
7. æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€
8. æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤

## GitHub Actions éƒ¨ç½²

GitHub Actions å·¥ä½œæµå·²ç»ä½¿ç”¨äº†ç›¸åŒçš„å¯†é’¥å¯¹ï¼š
- Secret åç§°: `DEPLOY_SSH_KEY`
- å¯¹åº”å¯†é’¥: `deploy_key`

éƒ¨ç½²å·¥ä½œæµä¼šè‡ªåŠ¨ä½¿ç”¨è¯¥å¯†é’¥è¿æ¥æœåŠ¡å™¨ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

## å®‰å…¨å»ºè®®

1. âœ… **ç§é’¥å·²æ’é™¤åœ¨ Git ä¹‹å¤–**
   - `deploy_key` ä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶

2. âš ï¸ **ä¿æŠ¤ç§é’¥æ–‡ä»¶**
   - ä¸è¦åˆ†äº« `deploy_key` æ–‡ä»¶
   - ä¸è¦é€šè¿‡é‚®ä»¶æˆ–èŠå¤©å·¥å…·ä¼ è¾“ç§é’¥
   - å»ºè®®å°†ç§é’¥å¤‡ä»½åˆ°å®‰å…¨çš„ä½ç½®

3. ğŸ”’ **å®šæœŸè½®æ¢å¯†é’¥**
   - å»ºè®®æ¯ 3-6 ä¸ªæœˆæ›´æ¢ä¸€æ¬¡ SSH å¯†é’¥
   - æ›´æ¢æ—¶ç”Ÿæˆæ–°å¯†é’¥å¯¹å¹¶æ›´æ–°æœåŠ¡å™¨çš„ authorized_keys

4. ğŸ“ **å®¡è®¡ç™»å½•è®°å½•**
   - å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çš„ `/var/log/auth.log`
   - æŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸ç™»å½•è¡Œä¸º

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: çªç„¶éœ€è¦è¾“å…¥å¯†ç 

**åŸå› **: æœåŠ¡å™¨ä¸Šçš„ authorized_keys æ–‡ä»¶æƒé™æˆ–å†…å®¹è¢«ä¿®æ”¹

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°è¿è¡Œé…ç½®è„šæœ¬
é…ç½®SSHå…å¯†ç™»å½•.bat

# æˆ–æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡å™¨
ssh root@8.153.110.212  # è¾“å…¥å¯†ç ç™»å½•
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
cat ~/.ssh/authorized_keys  # ç¡®è®¤å…¬é’¥å­˜åœ¨
```

### é—®é¢˜2: Connection refused

**åŸå› **: SSH æœåŠ¡æœªè¿è¡Œæˆ–é˜²ç«å¢™é˜»æ­¢

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ SSH æœåŠ¡çŠ¶æ€ï¼ˆéœ€è¦å…¶ä»–æ–¹å¼ç™»å½•æœåŠ¡å™¨ï¼‰
sudo systemctl status sshd

# æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
sudo ufw status
```

### é—®é¢˜3: Permission denied (publickey)

**åŸå› **: æœ¬åœ°ç§é’¥æ–‡ä»¶æƒé™è¿‡äºå®½æ¾

**è§£å†³æ–¹æ¡ˆ**:
```bash
# Windows Git Bash
chmod 600 ~/.ssh/deploy_key

# æˆ–é‡æ–°ç”Ÿæˆå¯†é’¥å¯¹
ssh-keygen -t ed25519 -f ~/.ssh/deploy_key -C "deploy-key"
```

## ä¸‹ä¸€æ­¥å»ºè®®

1. âœ… æµ‹è¯•å…å¯†ç™»å½•æ˜¯å¦æ­£å¸¸ - å·²å®Œæˆ
2. âœ… é…ç½® SSH config ç®€åŒ–ç™»å½• - å·²å®Œæˆ
3. â­ï¸ ç†Ÿæ‚‰æœåŠ¡å™¨ç®¡ç†å·¥å…·çš„ä½¿ç”¨
4. â­ï¸ å°†å…¶ä»–éœ€è¦ SSH çš„è„šæœ¬æ›´æ–°ä¸ºä½¿ç”¨å…å¯†ç™»å½•
5. â­ï¸ è€ƒè™‘ä¸ºå…¶ä»–å›¢é˜Ÿæˆå‘˜é…ç½® SSH è®¿é—®

## æ€»ç»“

SSH å…å¯†ç™»å½•å·²æˆåŠŸé…ç½®å¹¶æµ‹è¯•é€šè¿‡ã€‚ç°åœ¨ä½ å¯ä»¥ï¼š

- âœ… ä½¿ç”¨ `ssh member-server` å¿«é€Ÿç™»å½•æœåŠ¡å™¨
- âœ… ä½¿ç”¨æ‰¹å¤„ç†å·¥å…·æ–¹ä¾¿åœ°ç®¡ç†æœåŠ¡å™¨
- âœ… GitHub Actions è‡ªåŠ¨éƒ¨ç½²æ— éœ€é¢å¤–é…ç½®
- âœ… æ‰§è¡Œè¿œç¨‹å‘½ä»¤æ— éœ€è¾“å…¥å¯†ç 

é…ç½®å®Œæˆæ—¶é—´: 2026-01-24
é…ç½®çŠ¶æ€: âœ… æˆåŠŸ
